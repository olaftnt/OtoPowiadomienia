!function(u){var m=!1,b=!1,g="",f={},n="https://api.pushbots.com",o=0,r=null,h=null,v=null;u.init=function(e){if(document&&document.body){if(!m){if(m=!0,e=e||{},u.app_id=e.app_id||u.app_id||null,u.domain=e.domain||u.domain||null,u.scope=e.scope||u.scope||"/",u.welcome=e.welcome||u.welcome||!1,u.logging_enabled=e.logging_enabled||u.logging_enabled||!1,u.safari_push_id=u.safari_push_id||"web.com.pushbots.safaripush",u.worker_url=u.worker_url||u.domain+"/pushbots-worker.js",u.manifest_url=u.manifest_url||u.domain+"/pushbots-push-manifest.json",u.notification_permission_granted=!1,u.overlay=e.overlay||u.overlay||!1,"boolean"==typeof e.show_prompt||"boolean"==typeof u.show_prompt?u.show_prompt=e.show_prompt||u.show_prompt:u.show_prompt=!1,u.prompt_title=e.prompt_title||u.prompt_title||"Subscribe to our push notifications",u.prompt_body=e.prompt_body||u.prompt_body||"Keep up to date with our latest news by clicking Allow",u.prompt_allow_button=e.prompt_allow_button||u.prompt_allow_button||"Allow",u.prompt_later_button=e.prompt_later_button||u.prompt_later_button||"Maybe later",u.prompt_button_color=e.prompt_button_color||u.prompt_button_color||"#007bff",u.prompt_icon=e.prompt_icon||u.prompt_icon||"https://upload.wikimedia.org/wikipedia/commons/thumb/3/32/OOjs_UI_icon_bell_dimmed.svg/2000px-OOjs_UI_icon_bell_dimmed.svg.png","boolean"==typeof e.auto_subscribe||"boolean"==typeof u.auto_subscribe?u.auto_subscribe=e.auto_subscribe||u.auto_subscribe:u.auto_subscribe=!0,!u.app_id)return w("PushBots Application Id is required."),!1;if(!new RegExp("^[0-9a-fA-F]{24}$").test(u.app_id))return w("PushBots Application Id is invalid."),!1;if(u.events.constructor!==Array&&(u.events=[]),u.q.constructor!==Array&&(u.q=[]),-1===x(window.location.href.toLowerCase()).indexOf(x(u.domain.toLowerCase())))return w("You can only use this script on: "+u.domain),!1;if(d=navigator.userAgent,"iOS"==(h=-1==d.indexOf("Android")?-1==d.indexOf("iPhone")&&-1==d.indexOf("iPod")&&-1==d.indexOf("iPad")?"":"iOS":"Android"))return w("Safari on iOS doesn't support Push notifications."),!1;if(b=0===window.location.href.indexOf("https://"),b=!0,f=_(),"safari"==(g=f.title.toLowerCase())&&12<=parseFloat(f.ver)&&(u.show_prompt=!0,u.auto_subscribe=!1),"firefox"==g&&72<=parseFloat(f.ver)&&(u.show_prompt=!0,u.auto_subscribe=!1),"firefox"==g&&parseFloat(f.ver)<44)return w("Application can not work with Firefox browser version less then 44"),!1;if("chrome"==g&&parseFloat(f.ver)<50)return w("Application can not work with chrome browser version less then 50"),!1;if("safari"==g&&parseFloat(f.ver)<7)return w("Application can not work with safari browser version less then 7"),!1;if("firefox"==g&&"Android"==h)return w("Application can not work with Firefox on Android"),!1;"chrome"==g?v=2:"firefox"==g?v=3:"opera"==g?v=4:"safari"==g&&(v=5),y();var t,o="0.2s";t={bg:"#fff",bg_actions:"#e7eaee",bg_hover:"#eceff3",bg_light:"#f5f5f5",border_gray:"#e4ecf2",cancel_opacity:"1.0",text_title:"#5c6578",text_main:"#8b949b",text_tagline:"#ced9e6",text_hover:"#7c8598"};var i=document.createElement("div");i.id="inappID-wrapper";var n=document.body||document.getElementsByTagName("body")[0];if(n.appendChild(i),n)var r=Math.max(n.scrollWidth,document.documentElement.scrollWidth,n.offsetWidth,document.documentElement.offsetWidth,n.clientWidth,document.documentElement.clientWidth),p=Math.max(n.scrollHeight,document.documentElement.scrollHeight,n.offsetHeight,document.documentElement.offsetHeight,n.clientHeight,document.documentElement.clientHeight);var a={"#pb-web-overlay":{direction:"ltr",position:"fixed",top:"0",left:"0",width:"100%",height:"100%",overflow:"auto","text-align":"center","z-index":"10000","font-family":'"Helvetica", "Arial", sans-serif',"-webkit-font-smoothing":"antialiased","-moz-osx-font-smoothing":"grayscale"},"#pb-web-overlay a":{width:"initial",padding:"0","text-decoration":"none","text-transform":"none",color:"inherit"},"#pb-web-bgwrapper":{position:"relative",width:"100%",height:"100%"},"#pb-web-bg, #pb-web-bg-permission":{position:"fixed",top:"0",left:"0",width:"100%",height:"100%","min-width":4*r+"px","min-height":4*p+"px","background-color":"black",opacity:"0.0","-ms-filter":"progid:DXImageTransform.Microsoft.Alpha(Opacity=60)",filter:"alpha(opacity=60)",transition:"opacity "+o},"#pb-web-bg.visible, #pb-web-bg-permission.visible":{opacity:"0.6"},"#pb-web-inappmessage":{position:"absolute",left:"50%",width:"410px","margin-left":Math.round(-205)+"px","backface-visibility":"hidden",transform:"rotateY(0deg)",opacity:"0.0",top:"200px",transition:"opacity 0.2s, top "+o},"#pb-web-inappmessage.visible":{opacity:"1.0",top:"25px"},"#pb-web-inappmessage.exiting":{opacity:"0.0",top:"200px"},"#pb-web-mainbox":{"border-radius":"4px","box-shadow":"0px 0px 35px 0px rgba(45, 49, 56, 0.7)","text-align":"center","background-color":t.bg,"font-size":"14px",color:t.text_main},"#pb-web-content":{"font-family":"Roboto, sans-serif;",padding:"30px 20px 0px 20px"},"#pb-web-img":{width:"328px","margin-top":"30px","border-radius":"5px"},"#pb-web-title":{"max-height":"600px",overflow:"hidden","word-wrap":"break-word",padding:"25px 0px 20px 0px","font-size":"19px","font-weight":"bold",color:t.text_title},"#pb-web-body":{"max-height":"600px","margin-bottom":"25px",overflow:"hidden","word-wrap":"break-word","line-height":"21px","font-size":"15px","font-weight":"normal","text-align":"left"},"#pb-web-tagline":{"margin-bottom":"15px","font-size":"10px","font-weight":"600","letter-spacing":"0.8px",color:"#ccd7e0","text-align":"left"},"#pb-web-tagline a":{"font-size":"10px",color:t.text_tagline,transition:"color "+o},"#pb-web-tagline a:hover":{"font-size":"10px",color:t.text_hover},"#pb-web-cancel":{position:"absolute",right:"0",width:"8px",height:"8px",padding:"10px","border-radius":"20px",margin:"12px 12px 0 0","box-sizing":"content-box",cursor:"pointer",transition:"background-color "+o},"#pb-web-cancel-icon":{width:"8px",height:"8px",overflow:"hidden","background-image":"url(//cdn.pushbots.com/img/cancel-x.png)",opacity:t.cancel_opacity},"#pb-web-cancel:hover":{"background-color":t.bg_hover},"#pb-web-button":{display:"block",height:"60px","line-height":"60px","text-align":"center","background-color":t.bg_actions,"border-radius":"0 0 4px 4px",overflow:"hidden",cursor:"pointer",transition:"background-color "+o},"#pb-web-button-close":{display:"inline-block",width:"9px",height:"60px","margin-right":"8px","vertical-align":"top","background-image":"url(//cdn.pushbots.com/img/close-x-light.png)","background-repeat":"no-repeat","background-position":"0px 25px"},"a#pb-web-button-link":{display:"inline-block","vertical-align":"top","text-align":"center","font-size":"17px","font-weight":"bold",overflow:"hidden","word-wrap":"break-word",color:t.text_title,transition:"color "+o},"#pb-web-button:hover":{"background-color":t.bg_hover,color:t.text_hover},"#pb-web-button:hover a":{color:t.text_hover},".pb-prompt":{position:"fixed","z-index":"2147483646","text-transform":"none !important","letter-spacing":"normal !important"},".pb-prompt *":{"text-transform":"none","text-align":"start","text-decoration":"none","font-style":"normal","font-weight":"normal","line-height":"1em","box-sizing":"border-box"},".pb-prompt.pb-prompt-popup":{"max-width":"90vw",margin:"auto","background-color":"#eee",border:"1px solid #888","-webkit-box-shadow":"0 5px 15px rgba(0, 0, 0, 0.5)","box-shadow":"0 5px 15px rgba(0, 0, 0, 0.5)","font-family":"Arial, Helvetica, sans-serif",width:"400px"},".pb-prompt.pb-prompt-popup .pb-prompt-invitation-title,.pb-prompt.pb-prompt-popup .pb-prompt-invitation-body":{"font-size":"15px !important","line-height":"1.4em !important",width:"100%"},".pb-prompt.pb-prompt-popup .pb-prompt-invitation-title":{"font-weight":"bold"},".pb-prompt.pb-prompt-popup .pb-prompt-invitation-body":{"font-size":"13px !important","margin-top":"-10px"},".pb-prompt.pb-prompt-popup .pb-prompt-body":{"min-height":"100px",position:"relative","-ms-flex":"1 1 auto",flex:"1 1 auto","align-items":"center","justify-content":"flex-start","-webkit-flex-direction":"row","flex-direction":"row",display:"flex","flex-flow":"row wrap",padding:"10px 10px 10px 100px","text-align":"start"},".pb-prompt.pb-prompt-popup .pb-prompt-body img":{position:"absolute",top:"10px",left:"10px","max-width":"80px","max-height":"80px",margin:"0 auto !important"},".pb-prompt.pb-prompt-popup .pb-prompt-footer":{padding:"10px 5px",position:"relative"},".pb-prompt.pb-prompt-popup .pb-prompt-footer .pb-prompt-poweredby":{"line-height":"20px !important","font-size":"10px !important",color:"#CCC","text-decoration":"none","z-index":"0",margin:"5px",display:"inline-flex","text-transform":"uppercase"},".pb-prompt.pb-prompt-popup .pb-prompt-footer .pb-prompt-poweredby:visited":{color:"#CCC","text-transform":"uppercase"},".pb-prompt.pb-prompt-popup .pb-prompt-footer .pb-prompt-btn":{"z-index":"1"},".pb-prompt.top-center":{top:"20px",left:"50%"},".pb-prompt.pb-prompt-animation-grow":{"-webkit-animation-name":"pb-prompt-grow","-moz-animation-name":"pb-prompt-grow","-o-animation-name":"pb-prompt-grow","animation-name":"pb-prompt-grow","-webkit-animation-duration":".5s","-moz-animation-duration":".5s","-o-animation-duration":".5s","animation-duration":".5s"},"@keyframes pb-prompt-grow":{"from {   transform":"scale(0); }","to { transform":"scale(1); }"},".pb-prompt.theme-bootstrap":{"font-family":"Helvetica, Arial, sans-serif !important"},".pb-prompt.theme-bootstrap .pb-prompt-btn":{display:"inline-block","font-weight":"400 !important","text-align":"center","white-space":"nowrap","vertical-align":"middle","-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",border:"1px solid transparent","line-height":"1.5 !important",padding:"4px 8px","font-size":"14px !important","border-radius":"4px",transition:"background-color .15s ease-in-out, border-color .15s ease-in-out, box-shadow .15s ease-in-out",cursor:"pointer"},".pb-prompt.theme-bootstrap .pb-prompt-btn.pb-prompt-btn-default":{color:"#111","background-color":"#f8f9fa","border-color":"#f8f9fa"},".pb-prompt.theme-bootstrap .pb-prompt-btn.pb-prompt-btn-default:hover":{color:"#111","background-color":"#e2e6ea","border-color":"#dae0e5"},".pb-prompt.theme-bootstrap .pb-prompt-btn.pb-prompt-btn-primary":{color:"#fff","background-color":"#007bff","border-color":"#007bff"},".pb-prompt.theme-bootstrap .pb-prompt-btn.pb-prompt-btn-primary:hover":{color:"#fff","background-color":"#0069d9","border-color":"#0062cc"},".pb-prompt.theme-bootstrap.pb-prompt-popup":{display:"flex","-ms-flex-direction":"column","flex-direction":"column","pointer-events":"auto","background-color":"#fff",color:"#000","background-clip":"padding-box",border:"1px solid rgba(0, 0, 0, 0.2)","border-radius":".3rem !important",outline:"0","font-family":"Helvetica, Arial, sans-serif !important"},".pb-prompt.theme-bootstrap.pb-prompt-popup .pb-prompt-footer":{"border-top":"1px solid #e9ecef",display:"flex","-ms-flex-align":"center","align-items":"center","-ms-flex-pack":"end","justify-content":"space-between"},".pb-prompt.theme-bootstrap.pb-prompt-popup .pb-prompt-footer .pb-prompt-btn-group .pb-prompt-btn":{"margin-left":"5px","margin-right":"5px"}};!function(){if(!u.app_id)return w("Application ID must be set");try{var e=new XMLHttpRequest;e.open("GET","https://api.pushbots.com/3/webapp/"+u.app_id),e.send(),e.onload=function(){var e=null;this.response&&(e=JSON.parse(this.response)),w(e),u.show_prompt_popup(e)}}catch(e){w("Cannot get application data from Pushbots: "+e)}}(),s=function(e){var t="";for(var o in e){t+="\n"+o+" {";var i=e[o];for(var n in i)t+=n+":"+i[n]+";";t+="}"}return t}(a),l=document.head||document.getElementsByTagName("head")[0]||document.documentElement,c=document.createElement("style"),l.appendChild(c),c.setAttribute("type","text/css"),c.styleSheet?c.styleSheet.cssText=s:c.textContent=s}var s,l,c,d;u.show_inappmessage=function(a){function s(e,t){var o=document.getElementById(e);o.className?~(" "+o.className+" ").indexOf(" "+t+" ")||(o.className+=" "+t):o.className=t}function l(){e.style.visibility="hidden",n.removeChild(e)}function t(e){var t,o,i,n,r,p;e.preventDefault(),t="pb-web-bg",o="visible",(i=document.getElementById(t)).className&&(i.className=(" "+i.className+" ").replace(" "+o+" ","").replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")),s("pb-web-inappmessage","exiting"),n=a._id,r=JSON.stringify({device_id:localStorage.getItem("pushbots_userid"),inapp_id:n}),(p=new XMLHttpRequest).withCredentials=!0,p.addEventListener("readystatechange",function(){4===this.readyState&&console.log(this.responseText)}),p.open("POST","https://api.pushbots.com/2/inapp/opened"),p.setRequestHeader("Content-Type","application/json"),p.send(r),setTimeout(l,200)}a.fadingImage;var o="#dismiss";null!=a.primaryCtaIOS&&(o=a.primaryCtaIOS);var e;(e=document.getElementById("inappID-wrapper"))||((e=document.createElement("div")).id="inappID-wrapper",n.appendChild(e));e.innerHTML='<div id="pb-web-overlay"><div id="campaignid-22"><div id="pb-web-bgwrapper"><div id="pb-web-bg"></div><div id="pb-web-inappmessage"><div id="pb-web-mainbox"><div id="pb-web-cancel"><div id="pb-web-cancel-icon"></div></div><div id="pb-web-content"><img src="'+a.image+'" id="pb-web-img" /><div id="pb-web-title">'+a.title+'</div><div id="pb-web-body">'+a.msg+'</div><div id="pb-web-tagline"><a href="https://pushbots.com?from=inapp" target="_blank">POWERED BY PUSHBOTS</a></div></div><div id="pb-web-button"><a id="pb-web-button-link" href="'+o+'">'+a.primaryText+"</a></div></div></div></div></div></div>",n?setTimeout(function(){s("pb-web-bg","visible"),s("pb-web-inappmessage","visible"),document.getElementById("pb-web-cancel").addEventListener("click",function(e){t(e)}),document.getElementById("pb-web-bg").addEventListener("click",function(e){t(e)}),document.getElementById("pb-web-button").addEventListener("click",function(e){e.preventDefault(),t(e),"#dismiss"!=o&&(window.location.href=o)})},200):setTimeout(function(){u.show_inappmessage(a)},300)}}else setTimeout(function(){u.init(e)},350)},u.show_prompt_popup=function(e){void 0!==e.vapid&&localStorage.setItem("pb_vapid",e.vapid);var t=u.auto_subscribe;void 0!==e.auto_subscribe&&(t=e.auto_subscribe);var o=u.show_prompt;if(void 0!==e.show_prompt&&(o=e.show_prompt),f=_(),"safari"==(g=f.title.toLowerCase())&&12<=parseFloat(f.ver)&&(t=!(o=!0)),"firefox"==g&&72<=parseFloat(f.ver)&&(t=!(o=!0)),void 0!==e.show_overlay&&(u.overlay=e.show_overlay),t)u.register();else if(o&&"false"!==(o=localStorage.getItem("pb_prompt"))&&!1!==o){u.show_overlay(!0);var i=document.body||document.getElementsByTagName("body")[0],n=u.prompt_title;void 0!==e.prompt_title&&(n=e.prompt_title);var r=u.prompt_body;void 0!==e.prompt_body&&(r=e.prompt_body);var p=u.prompt_allow_button;void 0!==e.prompt_allow_button&&(p=e.prompt_allow_button);var a=u.prompt_later_button;void 0!==e.prompt_later_button&&(a=e.prompt_later_button);var s=u.prompt_icon;void 0!==e.prompt_icon&&(s=e.prompt_icon);var l=u.prompt_button_color;void 0!==e.prompt_button_color&&(l=e.prompt_button_color);var c='<a href="#"><span class="pb-prompt-btn pb-prompt-btn-primary pb-prompt-btn-allow" id="pb-prompt-allow" style="background-color:'+l+"; border-color: "+l+'">'+p+"</span></a>",d='<span class="pb-prompt-btn pb-prompt-btn-default pb-prompt-btn-cancel" id="pb-prompt-cancel">'+a+"</span>";if(!document.getElementById("pb-prompt-wrapper")){var m=document.createElement("div");m.id="pb-prompt-wrapper",i.appendChild(m)}m.innerHTML='<div class="pb-prompt pb-prompt-popup top-center theme-bootstrap pb-prompt-animation-grow" style="margin-left: -199px;"><div class="pb-prompt-body"><img src="'+s+'" /><div class="pb-prompt-invitation-title">'+n+'</div><div class="pb-prompt-invitation-body">'+r+'</div></div><div class="pb-prompt-footer"><a class="pb-prompt-poweredby" href="https://pushbots.com" target="_blank">Powered by PushBots</a><div class="pb-prompt-btn-group">'+d+c+"</div></div></div>",setTimeout(function(){document.getElementById("pb-prompt-allow").addEventListener("click",function(e){u.register(),b(e)}),document.getElementById("pb-prompt-cancel").addEventListener("click",function(e){e.preventDefault(),b(e),u.show_overlay(!1)})},200)}function b(e){e.preventDefault(),localStorage.setItem("pb_prompt",!1),i.removeChild(m)}},u.try_to_register=function(){if(u.show_prompt=!0,localStorage.setItem("pb_prompt",!0),u.app_id)try{var e=new XMLHttpRequest;e.open("GET","https://api.pushbots.com/3/webapp/"+u.app_id),e.send(),e.onload=function(){var e=null;this.response&&(e=JSON.parse(this.response)),w(e),u.show_prompt_popup(e)}}catch(e){w("Cannot get application data from Pushbots: "+e)}else w("Application ID must be set")},u.show_overlay=function(p){if(u.overlay){var e,t=document.body||document.getElementsByTagName("body")[0];if(!(e=document.getElementById("pushbots-inappID-wrapper-overlay")))(e=document.createElement("div")).id="pushbots-inappID-wrapper-overlay",t.appendChild(e);if(t)Math.max(t.scrollWidth,document.documentElement.scrollWidth,t.offsetWidth,document.documentElement.offsetWidth,t.clientWidth,document.documentElement.clientWidth),Math.max(t.scrollHeight,document.documentElement.scrollHeight,t.offsetHeight,document.documentElement.offsetHeight,t.clientHeight,document.documentElement.clientHeight);e.innerHTML='<div id="pb-web-overlay"><div id="pb-web-bg-permission"></div></div>',setTimeout(function(){var e,t,o,i,n,r;p?(i="pb-web-bg-permission",n="visible",void 0!==(r=document.getElementById(i))&&(r.className?~(" "+r.className+" ").indexOf(" "+n+" ")||(r.className+=" "+n):r.className=n)):(e="pb-web-bg-permission",t="visible",(o=document.getElementById(e)).className&&(o.className=(" "+o.className+" ").replace(" "+t+" ","").replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")),setTimeout(a,200))},200)}function a(){e.style.visibility="hidden",t.removeChild(e)}},u.register=function(){null===localStorage.getItem("pushbots_userid")?(r=function(){var e=window.crypto||window.msCrypto;{if(e&&e.getRandomValues){var t=new Uint16Array(8);e.getRandomValues(t),t[3]=4095&t[3]|16384,t[4]=16383&t[4]|32768;function o(e){for(var t=e.toString(16);t.length<4;)t="0"+t;return t}return o(t[0])+o(t[1]+o(t[2])+o(t[3])+o(t[4])+o(t[5])+o(t[6])+o(t[7]))}return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}}(),localStorage.setItem("pushbots_uuid",r),localStorage.setItem("pushbots_appid",u.app_id),b&&e()):localStorage.getItem("pushbots_appid")!=u.app_id?(w("Application Id has been changed, resetting data before starting"),localStorage.removeItem("pushbots_userid"),localStorage.removeItem("pushbots_uuid"),localStorage.removeItem("pushbots_appid"),u.register()):b&&e()},u.tag=function(e){e.constructor===Array&&0<e.length&&u.update({tags_add:e})},u.name=function(e){e.constructor===String&&u.update({name:e})},u.email=function(e){name.constructor===String&&u.update({email:e})},u.f_name=function(e){e.constructor===String&&u.update({f_name:e})},u.l_name=function(e){e.constructor===String&&u.update({l_name:e})},u.gender=function(e){e.constructor===String&&u.update({gender:e})},u.age=function(e){u.update({age:e})},u.untag=function(e){e.constructor===Array&&0<e.length&&u.update({tags_remove:e})},u.subscribe=function(e){"boolean"==typeof e&&u.update({subscribed:e})},u.alias=function(e){e.constructor===String&&u.update({alias:e})},u.update=function(e){e.timeZone=60*-(new Date).getTimezoneOffset(),e.metrics={osVersion:f.ver,locale:navigator.language.substring(0,2)||"en",PushBotslibVersion:"1.2.4"},null!=localStorage.getItem("pushbots_userid")?l(e,"PUT",n+"/2/subscriptions/"+localStorage.getItem("pushbots_userid"),localStorage.getItem("pushbots_userid")):w("User is not registered on PushBots!")},u.trakEvent=function(e,t){var o={event_key:e};void 0!==t&&(o.event_value=t),null!=localStorage.getItem("pushbots_userid")?l(o,"POST",n+"/2/events/"+localStorage.getItem("pushbots_userid"),localStorage.getItem("pushbots_userid")):w("User is not registered on PushBots!")},u.sendNotification=function(e){if(e.platform=v,w(e),null!=localStorage.getItem("pushbots_userid")&&"granted"===Notification.permission&&u.notification_permission_granted)l(e,"POST",n+"/2/push/notrack/"+localStorage.getItem("pushbots_userid"),localStorage.getItem("pushbots_userid"));else if("denied"===Notification.permission){u.show_inappmessage({title:"Browser is blocking notifications.",msg:"Please, enable push notifications in your browser. follow this GIF",image:"https://cdn.pushbots.com/img/denied.gif",primaryText:"OK"});for(var t=0;t<u.events.length;t++)"onReceived"===u.events[t][0]&&u.events[t][1]({statusCode:"blocked"})}else setTimeout(function(){u.sendNotification(e),w("User is not registered yet on PushBots!, trying again.")},1e3)};var s={databaseName:"pushbots_db",databaseVersion:1,datastore:null,openDB:function(t){var o=this;if(o.datastore)t();else{var e=(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB).open(this.databaseName,this.databaseVersion);e.onerror=function(e){w("Database error: "+e.target.errorCode)},e.onsuccess=function(e){o.datastore=e.target.result,t()},e.onupgradeneeded=function(e){e.target.result.createObjectStore("pushbots_ids",{keyPath:"type"})}}},createItem:function(e,t,o){var i=this;this.openDB(function(){i.datastore.transaction([e],"readwrite").objectStore(e).put(t).onsuccess=function(e){o(t.value)}})}};function w(){u.logging_enabled&&"undefined"!=typeof console&&void 0!==console.log&&void 0!==console.log.apply&&console.log.apply(console,arguments)}function e(){switch(g){case"safari":if(u.show_overlay(!0),"safari"in window&&"pushNotification"in window.safari){var e=window.safari.pushNotification.permission(u.safari_push_id);u.show_overlay(!1),i(e)}break;case"opera":case"chrome":case"firefox":if(b){var t=document.createElement("link");t.rel="manifest",t.href=u.manifest_url,document.head.appendChild(t)}"firefox"!==g||"serviceWorker"in navigator||w("please open about:config and set dom.serviceWorkers.testing.enabled to true"),"serviceWorker"in navigator&&(u.show_overlay(!0),w("Ask for Notifications Permission"),o=Date.now(),Notification.requestPermission(function(e){u.show_overlay(!1);var t=Date.now();switch(waited=!(t-o<50),w(e),e){case"granted":switch(g){case"chrome":case"firefox":case"opera":s.createItem("pushbots_ids",{type:"appID",value:u.app_id},function(e){switch(g){case"chrome":case"firefox":case"opera":navigator.serviceWorker.ready.then(function(e){w(e),e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:localStorage.getItem("pb_vapid")}).then(function(e){w(e);for(var t=function(e){switch(g){case"chrome":case"opera":if("subscriptionId"in e)var t=e.subscriptionId;else t=e.endpoint;return t.replace(new RegExp("^(https://fcm.googleapis.com/fcm/send/|https://android.googleapis.com/gcm/send/|https://updates.push.services.mozilla.com/push/|https://updates.push.services.mozilla.com/wpush/v1/|https://updates.push.services.mozilla.com/wpush/v2/)"),"");case"firefox":return(t=e.endpoint).replace(new RegExp("^(https://fcm.googleapis.com/fcm/send/|https://android.googleapis.com/gcm/send/|https://updates.push.services.mozilla.com/push/|https://updates.push.services.mozilla.com/wpush/v1/|https://updates.push.services.mozilla.com/wpush/v2/)"),"")}}(e),o=e.getKey?e.getKey("p256dh"):"",i=o?btoa(String.fromCharCode.apply(null,new Uint8Array(o))):"",n=e.getKey?e.getKey("auth"):"",r=n?btoa(String.fromCharCode.apply(null,new Uint8Array(n))):"",p=0;p<u.events.length;p++)"onRegistered"===u.events[p][0]&&u.events[p][1]({subscriptionId:t,rawKey:o,subscriptionPublicKey:i});a(t,i,r)})})}})}}}),navigator.serviceWorker.register(u.worker_url,{scope:u.scope}).then(function(e){w("worker reg.",e),e.installing?w("Service worker installing"):e.waiting?w("Service worker installed"):e.active&&w("Service worker active")}).catch(function(e){w("Registration failed with "+e)}))}}var i=function(e){w("The user is making a decision"),"default"===e.permission?(w("permission:default"),window.safari.pushNotification.requestPermission(n+"/",u.safari_push_id,{app_id:u.app_id},i)):"denied"===e.permission?w(e):"granted"===e.permission&&(w("permission:granted"),a(e.deviceToken),w("The user said yes, with token: "+e.deviceToken))};function x(e){return e.replace("://www.","://").replace("://www2.","://")}function _(){var e,t=navigator.userAgent,o=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[],i=t.match(/(edge(?=\/))\/?\s*(\d+)/i)||[];return"Edge"===i[1]?{title:i[1],ver:i[2]}:/trident/i.test(o[1])?{title:"IE",ver:(e=/\brv[ :]+(\d+)/g.exec(t)||[])[1]||""}:"Chrome"===o[1]&&null!=(e=t.match(/\bOPR\/(\d+)/))?{title:"Opera",ver:e[1]}:(o=o[2]?[o[1],o[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/(\d+)/i))&&o.splice(1,1,e[1]),{title:o[0],ver:o[1]})}function a(e,t,o){localStorage.setItem("pushbots_token",e),w("[PB] subscribe :: \nSubscriptionId: "+e+"\nSubscriptionPublicKey: "+t+"\nAuthSecret: "+o);var i={vapid:!0,token:e,udid:r,platform:v,key:t,authSecret:o,timeZone:60*-(new Date).getTimezoneOffset(),metrics:{osVersion:f.ver,locale:navigator.language.substring(0,2)||"en",PushBotslibVersion:"1.2.4"}};null===localStorage.getItem("pushbots_userid")?l(i,"POST",n+"/2/subscriptions",null):l(i,"PUT",n+"/2/subscriptions/"+localStorage.getItem("pushbots_userid"),localStorage.getItem("pushbots_userid"))}function l(r,e,p,a){try{var t=new XMLHttpRequest,o=JSON.stringify(r);t.open(e,p),t.setRequestHeader("X-pushbots-appid",u.app_id),t.setRequestHeader("content-type","application/json; charset=UTF-8"),t.onload=function(){var e=null;if(this.response&&(e=JSON.parse(this.response)),p.match(/notrack/))for(var t=0;t<u.events.length;t++)"onReceived"===u.events[t][0]&&u.events[t][1]({statusCode:this.status});w(e);var o,i,n=this.status;switch(n){case 200:case 201:window.indexedDB.open("pushbots_db",1);if(u.notification_permission_granted=!0,localStorage.setItem("pushbots_userid",a||e._id),w(a),201===n){for(t=0;t<u.events.length;t++)"onRegisteredOnPushBots"===u.events[t][0]&&u.events[t][1]({subscriptionId:r.subscriptionId,userId:a||e._id});w(n+": Registered user on PushBots successfully."),u.welcome&&u.sendNotification(u.welcome),"safari"!==g&&s.createItem("pushbots_ids",{type:"userid",value:a||e._id},function(e){})}else w(n+": Updated user on PushBots successfully."),null!=e&&null!=e.inapp&&(w("inapp"+e.inapp),0<e.inapp.length?(w("showing inapp message with id:",e.inapp[0]),o=a,(i=new XMLHttpRequest).withCredentials=!0,i.onload=function(){var e=null;this.response&&(e=JSON.parse(this.response)),w(e[0]),u.show_inappmessage(e[0])},i.open("GET","https://api.pushbots.com/2/inapp/"+o),i.send(null)):w("no inappmessage"));break;case 202:localStorage.removeItem("pushbots_userid"),localStorage.removeItem("pushbots_uuid"),localStorage.removeItem("pushbots_appid"),l(r.subscriptionId,r.subscriptionPublicKey,r.authSecret,"POST");break;default:w("Response Status code: "+n)}},t.send(o)}catch(e){w("Cannot register on Pushbots: "+e)}}function y(){if(void 0!==u.q&&0<u.q.length){for(var e=0;e<u.q.length;e++)if("function"==typeof u.q[e])u.q[e]();else{var t=u.q[e][0],o=u.q[e].slice(1);"function"==typeof u[t]&&u[t].apply(null,o)}u.q=[]}setTimeout(y,600)}}(window.PB=window.PB||{});
